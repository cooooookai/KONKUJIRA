<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯ç”¨æ€§æ˜¾ç¤ºæµ‹è¯• - Band Sync Calendar</title>
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.10/index.global.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.10/index.global.min.css" rel="stylesheet" />
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .api-test {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .calendar-container {
            margin-top: 20px;
        }
        
        /* Availability styling */
        .availability-good {
            background-color: rgba(76, 175, 80, 0.3) !important;
            border-color: #4CAF50 !important;
        }
        
        .availability-ok {
            background-color: rgba(255, 193, 7, 0.3) !important;
            border-color: #FFC107 !important;
        }
        
        .availability-bad {
            background-color: rgba(244, 67, 54, 0.3) !important;
            border-color: #F44336 !important;
        }
        
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #1976D2;
        }
        
        .status-display {
            font-family: monospace;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª å¯ç”¨æ€§æ˜¾ç¤ºæµ‹è¯•</h1>
            <p>æµ‹è¯•COKAIç”¨æˆ·14å·åœ†åœˆ(â—‹)çš„æ˜¾ç¤ºé—®é¢˜</p>
        </div>
        
        <div class="test-info">
            <h3>ğŸ“‹ æµ‹è¯•ä¿¡æ¯</h3>
            <p><strong>é—®é¢˜:</strong> COKAIç”¨æˆ·ä¿å­˜äº†14å·çš„åœ†åœˆ(â—‹)ï¼Œä½†åœ¨æ—¥å†é¢„è§ˆä¸­æ²¡æœ‰æ˜¾ç¤º</p>
            <p><strong>é¢„æœŸ:</strong> 14å·åº”è¯¥æ˜¾ç¤º "COKAI: â—‹" çš„èƒŒæ™¯äº‹ä»¶</p>
            <p><strong>API URL:</strong> https://band-sync-calendar-production.cooooookai.workers.dev</p>
        </div>
        
        <div class="api-test">
            <h3>ğŸ” APIæ•°æ®æµ‹è¯•</h3>
            <button class="test-button" onclick="testAPI()">æµ‹è¯•APIæ•°æ®</button>
            <button class="test-button" onclick="loadCalendar()">åŠ è½½æ—¥å†</button>
            <button class="test-button" onclick="clearCalendar()">æ¸…ç©ºæ—¥å†</button>
            <div id="api-status" class="status-display">ç‚¹å‡»"æµ‹è¯•APIæ•°æ®"æŸ¥çœ‹åŸå§‹æ•°æ®...</div>
        </div>
        
        <div class="calendar-container">
            <div id="calendar"></div>
        </div>
    </div>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.10/index.global.min.js"></script>
    
    <script>
        const API_BASE_URL = 'https://band-sync-calendar-production.cooooookai.workers.dev';
        let calendar = null;
        
        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ja',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth'
                },
                height: 'auto',
                events: []
            });
            
            calendar.render();
        });
        
        // Test API data
        async function testAPI() {
            const statusEl = document.getElementById('api-status');
            statusEl.textContent = 'æ­£åœ¨è·å–APIæ•°æ®...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/availability?start=2025-12-14&end=2025-12-15`);
                const data = await response.json();
                
                statusEl.textContent = `APIå“åº” (${response.status}):\n${JSON.stringify(data, null, 2)}`;
                
                // æŸ¥æ‰¾COKAIçš„æ•°æ®
                const cokaiData = data.filter(item => 
                    item.extendedProps && item.extendedProps.memberName === 'COKAI'
                );
                
                if (cokaiData.length > 0) {
                    statusEl.textContent += `\n\nâœ… æ‰¾åˆ°COKAIçš„æ•°æ® (${cokaiData.length}æ¡):\n${JSON.stringify(cokaiData, null, 2)}`;
                } else {
                    statusEl.textContent += '\n\nâŒ æ²¡æœ‰æ‰¾åˆ°COKAIçš„æ•°æ®';
                }
                
            } catch (error) {
                statusEl.textContent = `âŒ APIé”™è¯¯: ${error.message}`;
            }
        }
        
        // Load calendar with API data
        async function loadCalendar() {
            if (!calendar) return;
            
            const statusEl = document.getElementById('api-status');
            statusEl.textContent = 'æ­£åœ¨åŠ è½½æ—¥å†æ•°æ®...';
            
            try {
                // Get availability data
                const availResponse = await fetch(`${API_BASE_URL}/availability?start=2025-12-14&end=2025-12-15`);
                const availability = await availResponse.json();
                
                // Get events data
                const eventsResponse = await fetch(`${API_BASE_URL}/events?start=2025-12-14&end=2025-12-15`);
                const events = await eventsResponse.json();
                
                // Combine all data
                const allEvents = [...availability, ...events];
                
                // Clear existing events
                calendar.removeAllEvents();
                
                // Add new events
                calendar.addEventSource(allEvents);
                
                statusEl.textContent = `âœ… æ—¥å†åŠ è½½å®Œæˆï¼\nåŠ è½½äº† ${allEvents.length} ä¸ªäº‹ä»¶\nå¯ç”¨æ€§æ•°æ®: ${availability.length} æ¡\näº‹ä»¶æ•°æ®: ${events.length} æ¡`;
                
                // ç‰¹åˆ«æ£€æŸ¥COKAIçš„æ•°æ®
                const cokaiEvents = allEvents.filter(event => 
                    event.extendedProps && event.extendedProps.memberName === 'COKAI'
                );
                
                if (cokaiEvents.length > 0) {
                    statusEl.textContent += `\n\nğŸ¯ COKAIçš„äº‹ä»¶å·²åŠ è½½ (${cokaiEvents.length}æ¡):`;
                    cokaiEvents.forEach(event => {
                        statusEl.textContent += `\n- ${event.title} (${event.start} - ${event.end})`;
                    });
                }
                
            } catch (error) {
                statusEl.textContent = `âŒ åŠ è½½é”™è¯¯: ${error.message}`;
            }
        }
        
        // Clear calendar
        function clearCalendar() {
            if (calendar) {
                calendar.removeAllEvents();
                document.getElementById('api-status').textContent = 'æ—¥å†å·²æ¸…ç©º';
            }
        }
    </script>
</body>
</html>