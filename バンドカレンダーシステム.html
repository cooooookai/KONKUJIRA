<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Yu Gothic', 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 10px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .title {
            color: #ff4444;
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }
        
        .subtitle {
            color: #cccccc;
            font-size: 1.1em;
        }
        
        .nav-tabs {
            display: flex;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            color: #cccccc;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
        }
        
        .nav-tab:hover {
            background: linear-gradient(135deg, #cc3333 0%, #ff4444 100%);
            color: #ffffff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .user-info {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .name-input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border: 2px solid #ff4444;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .name-input:focus {
            outline: none;
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }
        
        .instructions {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-left: 5px solid #ff4444;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.2);
        }
        
        .instructions h3 {
            color: #ff4444;
            margin-bottom: 10px;
        }
        
        .symbol-guide {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .symbol-item {
            text-align: center;
            padding: 10px;
        }
        
        .symbol {
            display: inline-block;
            width: 35px;
            height: 35px;
            border: 2px solid #666666;
            border-radius: 50%;
            line-height: 31px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .symbol.good { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }
        .symbol.ok { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
            border-color: #888888;
            box-shadow: 0 0 15px rgba(136, 136, 136, 0.4);
        }
        .symbol.bad { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
        }
        
        .calendar-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .month-title {
            color: #ff4444;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #ff4444;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #000000;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ff4444;
        }
        
        .calendar-header {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1em;
        }
        
        .calendar-day {
            background: #2d2d2d;
            padding: 8px;
            min-height: 90px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #404040;
        }
        
        .calendar-day:hover {
            background: #3d3d3d;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.2);
        }
        
        .calendar-day.selectable {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 2px dashed #ff4444;
        }
        
        .calendar-day.selectable:hover {
            background: linear-gradient(135deg, #3d3d3d 0%, #2d2d2d 100%);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.3);
        }
        
        .calendar-day.other-month {
            background: #1a1a1a;
            color: #666;
        }
        
        .calendar-day.fixed-event {
            background: linear-gradient(135deg, #3d3d3d 0%, #4d4d4d 100%);
            border: 2px solid #ff4444;
        }
        
        .date-number {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 4px;
            text-align: center;
            color: #ffffff;
        }
        
        .event-label {
            background: linear-gradient(135deg, #666666 0%, #888888 100%);
            color: #ffffff;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.7em;
            text-align: center;
            line-height: 1.2;
            margin: 2px 0;
            font-weight: bold;
        }
        
        .event-label.fixed {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
        }
        
        .status-marker {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border: 2px solid #666666;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            color: #ffffff;
        }
        
        .status-marker:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }
        
        .status-marker.selected-good {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #000000;
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }
        
        .status-marker.selected-ok {
            background: linear-gradient(135deg, #666666 0%, #888888 100%);
            color: #ffffff;
            border-color: #888888;
            box-shadow: 0 0 15px rgba(136, 136, 136, 0.6);
        }
        
        .status-marker.selected-bad {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.6);
        }
        
        .submit-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff8888 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.4);
        }
        
        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .admin-section {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 10px;
            border: 2px dashed #ff4444;
        }
        
        .admin-title {
            color: #ff4444;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .form-input {
            flex: 1;
            min-width: 150px;
            padding: 8px;
            border: 1px solid #666666;
            border-radius: 4px;
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        .btn-success { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
        }
        .btn-danger { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        .btn-info { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .results-panel {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .result-item {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 1px solid #666666;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .result-name {
            font-weight: bold;
            color: #ff4444;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .result-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            font-size: 14px;
        }
        
        .result-date {
            padding: 6px 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: 500;
        }
        
        .result-good { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
        }
        .result-ok { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
        }
        .result-bad { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header {
                padding: 15px;
            }
            
            .title {
                font-size: 1.8em;
            }
            
            .calendar-section {
                padding: 15px;
            }
            
            .calendar-day {
                min-height: 70px;
                padding: 4px;
            }
            
            .status-marker {
                width: 20px;
                height: 20px;
                font-size: 12px;
            }
            
            .symbol-guide {
                gap: 15px;
            }
            
            .nav-tab {
                padding: 12px 8px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">ğŸµ ãƒãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
            <div class="subtitle">ç·´ç¿’æ—¥ç¨‹èª¿æ•´ã‚·ã‚¹ãƒ†ãƒ  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('calendar')">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¥åŠ›</button>
            <button class="nav-tab" onclick="showTab('admin')">âš™ï¸ ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('results')">ğŸ“Š çµæœ</button>
        </div>
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¥åŠ›ã‚¿ãƒ– -->
        <div id="calendar" class="tab-content active">
            <div class="user-info">
                <label for="userName" style="font-weight: bold; color: #ff4444; display: block; margin-bottom: 8px;">åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</label>
                <input type="text" id="userName" class="name-input" placeholder="ãŠåå‰ã‚’å…¥åŠ›" />
            </div>
            
            <div class="instructions">
                <h3>ğŸ“ ä½¿ç”¨æ–¹æ³•</h3>
                <p>å„ç·´ç¿’å€™è£œæ—¥ã®å³ä¸Šã«ã‚ã‚‹ä¸¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚ãªãŸã®éƒ½åˆã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š</p>
                <div class="symbol-guide">
                    <div class="symbol-item">
                        <div class="symbol good">â—‹</div>
                        <div>å¸Œæœ›ã®æ™‚é–“</div>
                    </div>
                    <div class="symbol-item">
                        <div class="symbol ok">â–³</div>
                        <div>å¯èƒ½ãªæ™‚é–“</div>
                    </div>
                    <div class="symbol-item">
                        <div class="symbol bad">âœ•</div>
                        <div>ä¸å¯èƒ½ãªæ™‚é–“</div>
                    </div>
                </div>
            </div>
            
            <div id="calendarContainer">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div class="submit-section">
                <button id="submitBtn" class="submit-btn" onclick="submitSchedule()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é€ä¿¡</button>
            </div>
        </div>
        
        <!-- ç®¡ç†ã‚¿ãƒ– -->
        <div id="admin" class="tab-content">
            <div class="admin-panel">
                <h2 style="color: #ff4444; margin-bottom: 25px;">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</h2>
                
                <div class="admin-section">
                    <div class="admin-title">ğŸ“… ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†</div>
                    <div id="eventsList"></div>
                    <div class="form-row">
                        <input type="date" id="newEventDate" class="form-input" />
                        <input type="text" id="newEventTitle" class="form-input" placeholder="ã‚¤ãƒ™ãƒ³ãƒˆå" />
                        <button class="btn btn-success" onclick="addEvent()">è¿½åŠ </button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                    <div class="form-row">
                        <button class="btn btn-info" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                        <button class="btn btn-danger" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                        <button class="btn btn-primary" onclick="generateNewPeriod()">æ–°æœŸé–“ç”Ÿæˆ</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">âš™ï¸ æœŸé–“è¨­å®š</div>
                    <div class="form-row">
                        <label>é–‹å§‹æ—¥:</label>
                        <input type="date" id="startDate" class="form-input" />
                        <label>çµ‚äº†æ—¥:</label>
                        <input type="date" id="endDate" class="form-input" />
                        <button class="btn btn-primary" onclick="updatePeriod()">æ›´æ–°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çµæœã‚¿ãƒ– -->
        <div id="results" class="tab-content">
            <div class="results-panel">
                <h2 style="color: #ff4444; margin-bottom: 25px;">ğŸ“Š å›ç­”çµæœ</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-info" onclick="exportResults()">çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn btn-primary" onclick="showSummary()">ã‚µãƒãƒªãƒ¼è¡¨ç¤º</button>
                    <button class="btn btn-success" onclick="refreshResults()">æ›´æ–°</button>
                </div>
                
                <div id="resultsList"></div>
                
                <div id="summarySection" style="display: none; margin-top: 30px;">
                    <h3 style="color: #ff4444;">ğŸ“ˆ æ—¥ç¨‹ã‚µãƒãƒªãƒ¼</h3>
                    <div id="summaryContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        let scheduleData = JSON.parse(localStorage.getItem('bandCalendarData')) || {
            responses: [],
            fixedEvents: [
                { date: '2024-12-19', title: 'å‘¨å¹´ç¥­é…ä¿¡ãƒ»æ ªä¸»ç·ä¼š' },
                { date: '2025-01-01', title: 'ã€Œé¯¨ã€éŒ²éŸ³å®Œäº†' },
                { date: '2025-01-11', title: 'ä¸‹åŒ—æ²¢threeå¯¾ãƒãƒ³ãƒ©ã‚¤ãƒ–' },
                { date: '2025-01-19', title: 'ãƒŸãƒƒã‚¯ã‚¹å®Œäº†ãƒ»é¯¨MVé…ä¿¡' }
            ],
            period: {
                start: '2024-12-14',
                end: '2025-01-31'
            }
        };
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('bandCalendarData', JSON.stringify(scheduleData));
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'calendar') {
                generateCalendar();
            } else if (tabName === 'admin') {
                generateAdminPanel();
            } else if (tabName === 'results') {
                generateResultsPanel();
            }
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateCalendar() {
            const container = document.getElementById('calendarContainer');
            const startDate = new Date(scheduleData.period.start);
            const endDate = new Date(scheduleData.period.end);
            
            let html = '';
            let currentDate = new Date(startDate);
            
            // æœˆã”ã¨ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
            while (currentDate <= endDate) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                html += generateMonthCalendar(year, month);
                
                // æ¬¡ã®æœˆã¸
                currentDate.setMonth(month + 1);
                currentDate.setDate(1);
            }
            
            container.innerHTML = html;
        }
        
        // æœˆåˆ¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateMonthCalendar(year, month) {
            // æ™‚é–“ã‚’æ­£åˆã«è¨­å®šã—ã¦æ™‚åŒºå•é¡Œã‚’é¿ã‘ã‚‹
            const firstDay = new Date(year, month, 1, 12, 0, 0);
            const lastDay = new Date(year, month + 1, 0, 12, 0, 0);
            
            // æœˆã®æœ€åˆã®æ—¥ã‹ã‚‰ã€ãã®é€±ã®æ—¥æ›œæ—¥ã¾ã§æˆ»ã‚‹
            const startOfWeek = new Date(year, month, 1 - firstDay.getDay(), 12, 0, 0);
            
            let html = `
                <div class="calendar-section">
                    <div class="month-title">ğŸ“… ${year}å¹´${month + 1}æœˆ</div>
                    <div class="calendar">
                        <div class="calendar-header">æ—¥</div>
                        <div class="calendar-header">æœˆ</div>
                        <div class="calendar-header">ç«</div>
                        <div class="calendar-header">æ°´</div>
                        <div class="calendar-header">æœ¨</div>
                        <div class="calendar-header">é‡‘</div>
                        <div class="calendar-header">åœŸ</div>
            `;
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
            let currentDate = new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate(), 12, 0, 0);
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    // æ—¥ä»˜æ–‡å­—åˆ—ã‚’æ­£ç¢ºã«ç”Ÿæˆ
                    const dateYear = currentDate.getFullYear();
                    const dateMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const dateDay = String(currentDate.getDate()).padStart(2, '0');
                    const dateStr = `${dateYear}-${dateMonth}-${dateDay}`;
                    
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isSelectable = isCurrentMonth && isDateSelectable(dateStr);
                    const fixedEvent = scheduleData.fixedEvents.find(e => e.date === dateStr);
                    
                    let dayClass = 'calendar-day';
                    if (!isCurrentMonth) dayClass += ' other-month';
                    if (isSelectable) dayClass += ' selectable';
                    if (fixedEvent) dayClass += ' fixed-event';
                    
                    html += `<div class="${dayClass}" onclick="toggleDateStatus('${dateStr}')">`;
                    html += `<div class="date-number">${currentDate.getDate()}</div>`;
                    
                    if (fixedEvent) {
                        html += `<div class="event-label fixed">${fixedEvent.title}</div>`;
                    } else if (isSelectable) {
                        html += `<div class="event-label">ç·´ç¿’å€™è£œ</div>`;
                        html += `<div class="status-marker" data-date="${dateStr}"></div>`;
                    }
                    
                    html += '</div>';
                    
                    // æ¬¡ã®æ—¥ã«é€²ã‚€
                    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() + 1, 12, 0, 0);
                }
                
                // æœˆãŒå¤‰ã‚ã£ãŸã‚‰çµ‚äº†
                if (currentDate.getMonth() !== month && week > 0) break;
            }
            
            html += '</div></div>';
            return html;
        }
        
        // æ—¥ä»˜ãŒé¸æŠå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
        function isDateSelectable(dateStr) {
            // æ™‚åŒºå•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚ã€æ­£åˆã®æ™‚é–“ã§æ¯”è¼ƒ
            const date = new Date(dateStr + 'T12:00:00');
            const start = new Date(scheduleData.period.start + 'T12:00:00');
            const end = new Date(scheduleData.period.end + 'T12:00:00');
            
            return date >= start && date <= end && 
                   !scheduleData.fixedEvents.some(e => e.date === dateStr);
        }
        
        // æ—¥ä»˜ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆ
        function toggleDateStatus(dateStr) {
            if (!isDateSelectable(dateStr)) return;
            
            const marker = document.querySelector(`[data-date="${dateStr}"]`);
            if (!marker) return;
            
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—
            let currentStatus = '';
            if (marker.classList.contains('selected-good')) currentStatus = 'good';
            else if (marker.classList.contains('selected-ok')) currentStatus = 'ok';
            else if (marker.classList.contains('selected-bad')) currentStatus = 'bad';
            
            // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆ
            const statuses = ['', 'good', 'ok', 'bad'];
            const symbols = ['', 'â—‹', 'â–³', 'âœ•'];
            const currentIndex = statuses.indexOf(currentStatus);
            const nextIndex = (currentIndex + 1) % statuses.length;
            
            // ã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
            marker.classList.remove('selected-good', 'selected-ok', 'selected-bad');
            marker.textContent = '';
            
            // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
            if (statuses[nextIndex]) {
                marker.classList.add(`selected-${statuses[nextIndex]}`);
                marker.textContent = symbols[nextIndex];
            }
        }
        
        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é€ä¿¡
        function submitSchedule() {
            const name = document.getElementById('userName').value.trim();
            if (!name) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // é¸æŠã•ã‚ŒãŸæ—¥ç¨‹ã‚’åé›†
            const selections = {};
            document.querySelectorAll('.status-marker.selected-good, .status-marker.selected-ok, .status-marker.selected-bad').forEach(marker => {
                const date = marker.dataset.date;
                let status = '';
                if (marker.classList.contains('selected-good')) status = 'good';
                else if (marker.classList.contains('selected-ok')) status = 'ok';
                else if (marker.classList.contains('selected-bad')) status = 'bad';
                
                if (status) selections[date] = status;
            });
            
            if (Object.keys(selections).length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®æ—¥ç¨‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            const existingIndex = scheduleData.responses.findIndex(r => r.name === name);
            const response = {
                name: name,
                selections: selections,
                timestamp: new Date().toISOString()
            };
            
            if (existingIndex >= 0) {
                if (confirm('æ—¢å­˜ã®å›ç­”ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ')) {
                    scheduleData.responses[existingIndex] = response;
                } else {
                    return;
                }
            } else {
                scheduleData.responses.push(response);
            }
            
            saveData();
            alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('userName').value = '';
            document.querySelectorAll('.status-marker').forEach(marker => {
                marker.classList.remove('selected-good', 'selected-ok', 'selected-bad');
                marker.textContent = '';
            });
        }
        
        // ç®¡ç†ç”»é¢ç”Ÿæˆ
        function generateAdminPanel() {
            const eventsList = document.getElementById('eventsList');
            eventsList.innerHTML = scheduleData.fixedEvents.map((event, index) => `
                <div class="form-row">
                    <input type="date" value="${event.date}" class="form-input" readonly>
                    <input type="text" value="${event.title}" class="form-input" readonly>
                    <button class="btn btn-danger" onclick="removeEvent(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
            
            document.getElementById('startDate').value = scheduleData.period.start;
            document.getElementById('endDate').value = scheduleData.period.end;
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
        function addEvent() {
            const date = document.getElementById('newEventDate').value;
            const title = document.getElementById('newEventTitle').value.trim();
            
            if (!date || !title) {
                alert('æ—¥ä»˜ã¨ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            scheduleData.fixedEvents.push({ date, title });
            scheduleData.fixedEvents.sort((a, b) => a.date.localeCompare(b.date));
            saveData();
            generateAdminPanel();
            
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventTitle').value = '';
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤
        function removeEvent(index) {
            if (confirm('ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                scheduleData.fixedEvents.splice(index, 1);
                saveData();
                generateAdminPanel();
            }
        }
        
        // æœŸé–“æ›´æ–°
        function updatePeriod() {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            
            if (!start || !end) {
                alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (start >= end) {
                alert('çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„');
                return;
            }
            
            scheduleData.period = { start, end };
            saveData();
            alert('æœŸé–“ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
        }
        
        // çµæœç”»é¢ç”Ÿæˆ
        function generateResultsPanel() {
            const resultsList = document.getElementById('resultsList');
            
            if (scheduleData.responses.length === 0) {
                resultsList.innerHTML = '<p style="text-align: center; color: #cccccc; padding: 40px;">ã¾ã å›ç­”ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            resultsList.innerHTML = scheduleData.responses.map(response => `
                <div class="result-item">
                    <div class="result-name">${response.name}</div>
                    <div class="result-summary">
                        ${Object.entries(response.selections).map(([date, status]) => `
                            <div class="result-date result-${status}">
                                ${formatDateShort(date)}: ${getStatusText(status)}
                            </div>
                        `).join('')}
                    </div>
                    <div style="font-size: 12px; color: #cccccc; margin-top: 10px;">
                        é€ä¿¡: ${new Date(response.timestamp).toLocaleString('ja-JP')}
                    </div>
                </div>
            `).join('');
        }
        
        // ã‚µãƒãƒªãƒ¼è¡¨ç¤º
        function showSummary() {
            const summarySection = document.getElementById('summarySection');
            const summaryContent = document.getElementById('summaryContent');
            
            // æ—¥ä»˜åˆ¥é›†è¨ˆ
            const dateSummary = {};
            scheduleData.responses.forEach(response => {
                Object.entries(response.selections).forEach(([date, status]) => {
                    if (!dateSummary[date]) {
                        dateSummary[date] = { good: 0, ok: 0, bad: 0 };
                    }
                    dateSummary[date][status]++;
                });
            });
            
            const sortedDates = Object.keys(dateSummary).sort();
            
            summaryContent.innerHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 15px; background: #2d2d2d; border: 1px solid #ff4444;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);">
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">æ—¥ä»˜</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">å¸Œæœ›</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">å¯èƒ½</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">ä¸å¯</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">åˆè¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedDates.map(date => {
                                const summary = dateSummary[date];
                                const total = summary.good + summary.ok + summary.bad;
                                return `
                                    <tr>
                                        <td style="border: 1px solid #ff4444; padding: 10px; font-weight: bold; color: #ffffff;">${formatDateWithDay(date)}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); color: #000000;">${summary.good}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #666666 0%, #888888 100%); color: #ffffff;">${summary.ok}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); color: #ffffff;">${summary.bad}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; font-weight: bold; color: #ffffff;">${total}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            summarySection.style.display = 'block';
        }
        
        // çµæœæ›´æ–°
        function refreshResults() {
            generateResultsPanel();
            document.getElementById('summarySection').style.display = 'none';
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportResults() {
            const data = {
                exportDate: new Date().toISOString(),
                period: scheduleData.period,
                fixedEvents: scheduleData.fixedEvents,
                responses: scheduleData.responses
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `band-calendar-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearAllData() {
            if (confirm('å…¨ã¦ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                scheduleData.responses = [];
                saveData();
                alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
                generateResultsPanel();
            }
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatDateShort(dateStr) {
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }
        
        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr);
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆ${days[date.getDay()]}ï¼‰`;
        }
        
        function getStatusText(status) {
            const texts = { good: 'å¸Œæœ›', ok: 'å¯èƒ½', bad: 'ä¸å¯' };
            return texts[status] || status;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
        });
    </script>
</body>
</html>