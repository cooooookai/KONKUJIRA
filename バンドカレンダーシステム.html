<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Yu Gothic', 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 10px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .title {
            color: #ff4444;
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }
        
        .subtitle {
            color: #cccccc;
            font-size: 1.1em;
        }
        
        .nav-tabs {
            display: flex;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            color: #cccccc;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
        }
        
        .nav-tab:hover {
            background: linear-gradient(135deg, #cc3333 0%, #ff4444 100%);
            color: #ffffff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .user-info {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .name-input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border: 2px solid #ff4444;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .name-input:focus {
            outline: none;
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }
        
        .instructions {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-left: 5px solid #ff4444;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.2);
        }
        
        .instructions h3 {
            color: #ff4444;
            margin-bottom: 10px;
        }
        
        .symbol-guide {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .symbol-item {
            text-align: center;
            padding: 10px;
        }
        
        .symbol {
            display: inline-block;
            width: 35px;
            height: 35px;
            border: 2px solid #666666;
            border-radius: 50%;
            line-height: 31px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .symbol.good { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }
        .symbol.ok { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
            border-color: #888888;
            box-shadow: 0 0 15px rgba(136, 136, 136, 0.4);
        }
        .symbol.bad { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
        }
        
        .calendar-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .month-title {
            color: #ff4444;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #ff4444;
            text-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #000000;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ff4444;
        }
        
        .calendar-header {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1em;
        }
        
        .calendar-day {
            background: #2d2d2d;
            padding: 8px;
            min-height: 90px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #404040;
        }
        
        .calendar-day:hover {
            background: #3d3d3d;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.2);
        }
        
        .calendar-day.selectable {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 2px dashed #ff4444;
        }
        
        .calendar-day.selectable:hover {
            background: linear-gradient(135deg, #3d3d3d 0%, #2d2d2d 100%);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.3);
        }
        
        .calendar-day.other-month {
            background: #1a1a1a;
            color: #666;
        }
        
        .calendar-day.fixed-event {
            background: linear-gradient(135deg, #3d3d3d 0%, #4d4d4d 100%);
            border: 2px solid #ff4444;
        }
        
        .calendar-day.today {
            border: 3px solid #ff4444 !important;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
        }
        
        .calendar-day.today .date-number {
            color: #ff4444;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
        }
        
        .date-number {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 4px;
            text-align: center;
            color: #ffffff;
        }
        
        .event-label {
            background: linear-gradient(135deg, #666666 0%, #888888 100%);
            color: #ffffff;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.7em;
            text-align: center;
            line-height: 1.2;
            margin: 2px 0;
            font-weight: bold;
        }
        
        .event-label.fixed {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
        }
        
        .status-marker {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border: 2px solid #666666;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            color: #ffffff;
        }
        
        .status-marker:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
        }
        
        .status-marker.selected-good {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #000000;
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }
        
        .status-marker.selected-ok {
            background: linear-gradient(135deg, #666666 0%, #888888 100%);
            color: #ffffff;
            border-color: #888888;
            box-shadow: 0 0 15px rgba(136, 136, 136, 0.6);
        }
        
        .status-marker.selected-bad {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.6);
        }
        
        .submit-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(255, 68, 68, 0.2);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            color: #ffffff;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff8888 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.4);
        }
        
        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .admin-section {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 10px;
            border: 2px dashed #ff4444;
        }
        
        .admin-title {
            color: #ff4444;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .form-input {
            flex: 1;
            min-width: 150px;
            padding: 8px;
            border: 1px solid #666666;
            border-radius: 4px;
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        .btn-success { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
        }
        .btn-danger { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        .btn-info { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .results-panel {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.3);
        }
        
        .result-item {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 1px solid #666666;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .result-name {
            font-weight: bold;
            color: #ff4444;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .result-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            font-size: 14px;
        }
        
        .result-date {
            padding: 6px 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: 500;
        }
        
        .result-good { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #000000; 
        }
        .result-ok { 
            background: linear-gradient(135deg, #666666 0%, #888888 100%); 
            color: #ffffff; 
        }
        .result-bad { 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); 
            color: #ffffff; 
        }
        
        /* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header {
                padding: 15px;
            }
            
            .title {
                font-size: 1.8em;
            }
            
            .calendar-section {
                padding: 10px;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 2px;
                font-size: 12px;
            }
            
            .date-number {
                font-size: 0.9em;
            }
            
            .event-label {
                font-size: 0.6em;
                padding: 1px 2px;
            }
            
            .status-marker {
                width: 18px;
                height: 18px;
                font-size: 10px;
                top: 2px;
                right: 2px;
            }
            
            .symbol-guide {
                gap: 10px;
            }
            
            .symbol {
                width: 30px;
                height: 30px;
                line-height: 26px;
                font-size: 16px;
            }
            
            .nav-tab {
                padding: 10px 6px;
                font-size: 13px;
            }
            
            .name-input {
                font-size: 14px;
                padding: 10px;
            }
            
            .submit-btn {
                padding: 12px 30px;
                font-size: 16px;
            }
        }
        
        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .calendar-day {
                min-height: 50px;
                padding: 1px;
            }
            
            .date-number {
                font-size: 0.8em;
                margin-bottom: 2px;
            }
            
            .event-label {
                font-size: 0.5em;
                margin: 1px 0;
            }
            
            .status-marker {
                width: 16px;
                height: 16px;
                font-size: 9px;
            }
            
            .month-title {
                font-size: 1.2em;
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">ğŸµ ãƒãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
            <div class="subtitle">ç·´ç¿’æ—¥ç¨‹èª¿æ•´ã‚·ã‚¹ãƒ†ãƒ  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </div>
            <div id="syncStatus" style="margin-top: 10px; font-size: 0.9em; color: #cccccc;">
                <span id="syncIcon">ğŸ”„</span> <span id="syncText">åŒæœŸæº–å‚™ä¸­...</span>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('calendar')">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¥åŠ›</button>
            <button class="nav-tab" onclick="showTab('admin')">âš™ï¸ ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('results')">ğŸ“Š çµæœ</button>
        </div>
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¥åŠ›ã‚¿ãƒ– -->
        <div id="calendar" class="tab-content active">
            <div class="user-info">
                <label for="userName" style="font-weight: bold; color: #ff4444; display: block; margin-bottom: 8px;">åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</label>
                <input type="text" id="userName" class="name-input" placeholder="ãŠåå‰ã‚’å…¥åŠ›" />
            </div>
            
            <div class="instructions">
                <h3>ğŸ“ ä½¿ç”¨æ–¹æ³•</h3>
                <p>å„ç·´ç¿’å€™è£œæ—¥ã®å³ä¸Šã«ã‚ã‚‹ä¸¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚ãªãŸã®éƒ½åˆã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š</p>
                <div class="symbol-guide">
                    <div class="symbol-item">
                        <div class="symbol good">â—‹</div>
                        <div>å¸Œæœ›ã®æ™‚é–“</div>
                    </div>
                    <div class="symbol-item">
                        <div class="symbol ok">â–³</div>
                        <div>å¯èƒ½ãªæ™‚é–“</div>
                    </div>
                    <div class="symbol-item">
                        <div class="symbol bad">âœ•</div>
                        <div>ä¸å¯èƒ½ãªæ™‚é–“</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(255, 68, 68, 0.1); border-radius: 5px;">
                    <strong>ğŸ’¡ ä¾¿åˆ©æ©Ÿèƒ½ï¼š</strong>
                    <div style="margin-top: 5px; font-size: 0.9em;">
                        â€¢ å…¨ã¦å¸Œæœ›: <button class="btn btn-success" onclick="setAllStatus('good')" style="padding: 2px 8px; font-size: 0.8em;">å…¨â—‹</button>
                        â€¢ å…¨ã¦ä¸å¯: <button class="btn btn-danger" onclick="setAllStatus('bad')" style="padding: 2px 8px; font-size: 0.8em;">å…¨âœ•</button>
                        â€¢ ãƒªã‚»ãƒƒãƒˆ: <button class="btn btn-info" onclick="clearAllStatus()" style="padding: 2px 8px; font-size: 0.8em;">ã‚¯ãƒªã‚¢</button>
                    </div>
                </div>
            </div>
            
            <div id="calendarContainer">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            
            <div class="submit-section">
                <div id="progressInfo" style="margin-bottom: 15px; color: #cccccc; font-size: 14px;">
                    é¸æŠæ¸ˆã¿: <span id="selectedCount">0</span> / <span id="totalCount">0</span> æ—¥ç¨‹
                </div>
                <div id="progressBar" style="width: 100%; height: 6px; background: #333; border-radius: 3px; margin-bottom: 15px; overflow: hidden;">
                    <div id="progressFill" style="height: 100%; background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); width: 0%; transition: width 0.3s;"></div>
                </div>
                <button id="submitBtn" class="submit-btn" onclick="submitSchedule()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é€ä¿¡</button>
            </div>
        </div>
        
        <!-- ç®¡ç†ã‚¿ãƒ– -->
        <div id="admin" class="tab-content">
            <div class="admin-panel">
                <h2 style="color: #ff4444; margin-bottom: 25px;">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</h2>
                
                <div class="admin-section">
                    <div class="admin-title">ğŸ“… ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†</div>
                    <div id="eventsList"></div>
                    <div class="form-row">
                        <input type="date" id="newEventDate" class="form-input" />
                        <input type="text" id="newEventTitle" class="form-input" placeholder="ã‚¤ãƒ™ãƒ³ãƒˆå" />
                        <button class="btn btn-success" onclick="addEvent()">è¿½åŠ </button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                    <div class="form-row">
                        <button class="btn btn-info" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                        <button class="btn btn-danger" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                        <button class="btn btn-primary" onclick="generateNewPeriod()">æ–°æœŸé–“ç”Ÿæˆ</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">âš™ï¸ æœŸé–“è¨­å®š</div>
                    <div class="form-row">
                        <label>é–‹å§‹æ—¥:</label>
                        <input type="date" id="startDate" class="form-input" />
                        <label>çµ‚äº†æ—¥:</label>
                        <input type="date" id="endDate" class="form-input" />
                        <button class="btn btn-primary" onclick="updatePeriod()">æ›´æ–°</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çµæœã‚¿ãƒ– -->
        <div id="results" class="tab-content">
            <div class="results-panel">
                <h2 style="color: #ff4444; margin-bottom: 25px;">ğŸ“Š å›ç­”çµæœ</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-info" onclick="exportResults()">çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn btn-primary" onclick="showSummary()">ã‚µãƒãƒªãƒ¼è¡¨ç¤º</button>
                    <button class="btn btn-success" onclick="refreshResults()">æ›´æ–°</button>
                    <button class="btn btn-success" onclick="generateShareLink()">å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ</button>
                    <button class="btn btn-info" onclick="showImportSection()">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                </div>
                
                <div id="deleteSection" style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); border: 1px solid #ff4444; border-radius: 8px;">
                    <h4 style="color: #ff4444; margin-bottom: 15px;">ğŸ—‘ï¸ å›ç­”å‰Šé™¤</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <button class="btn btn-info" onclick="toggleSelectMode()" id="selectModeBtn">é¸æŠãƒ¢ãƒ¼ãƒ‰</button>
                        <button class="btn btn-success" onclick="selectAll()" id="selectAllBtn" style="display: none;">å…¨é¸æŠ</button>
                        <button class="btn btn-info" onclick="selectNone()" id="selectNoneBtn" style="display: none;">é¸æŠè§£é™¤</button>
                        <button class="btn btn-danger" onclick="deleteSelected()" id="deleteSelectedBtn" style="display: none;">é¸æŠé …ç›®ã‚’å‰Šé™¤</button>
                        <button class="btn btn-info" onclick="cancelSelectMode()" id="cancelBtn" style="display: none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <span id="selectedCount" style="color: #cccccc; margin-left: 10px; display: none;">é¸æŠ: 0ä»¶</span>
                    </div>
                </div>
                
                <div id="shareSection" style="display: none; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); border: 1px solid #ff4444; border-radius: 8px;">
                    <h4 style="color: #ff4444; margin-bottom: 10px;">ğŸ“± ãƒ‡ãƒã‚¤ã‚¹é–“å…±æœ‰</h4>
                    <p style="color: #cccccc; margin-bottom: 10px;">ã“ã®ãƒªãƒ³ã‚¯ã‚’ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§é–‹ãã¨ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãŒåŒæœŸã•ã‚Œã¾ã™ï¼š</p>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                        <input type="text" id="shareLink" readonly style="flex: 1; padding: 8px; background: #1a1a1a; color: #ffffff; border: 1px solid #666; border-radius: 4px; font-size: 12px;">
                        <button onclick="copyShareLink()" class="btn btn-info" style="padding: 8px 15px;">ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div style="text-align: center;">
                        <div id="qrcode" style="display: inline-block; padding: 10px; background: white; border-radius: 8px;"></div>
                        <p style="color: #cccccc; font-size: 12px; margin-top: 10px;">ğŸ“± ã‚¹ãƒãƒ›ã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
                    </div>
                </div>
                
                <div id="importSection" style="display: none; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); border: 1px solid #ff4444; border-radius: 8px;">
                    <h4 style="color: #ff4444; margin-bottom: 10px;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h4>
                    <p style="color: #cccccc; margin-bottom: 10px;">ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸï¼š</p>
                    <div style="margin-bottom: 15px;">
                        <input type="file" id="importFile" accept=".json" style="color: #ffffff; background: #1a1a1a; border: 1px solid #666; border-radius: 4px; padding: 8px; width: 100%;">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="importData()" class="btn btn-success">ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
                        <button onclick="hideImportSection()" class="btn btn-info">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </div>
                
                <div id="resultsList"></div>
                
                <div id="summarySection" style="display: none; margin-top: 30px;">
                    <h3 style="color: #ff4444;">ğŸ“ˆ æ—¥ç¨‹ã‚µãƒãƒªãƒ¼</h3>
                    <div id="summaryContent"></div>
                </div>
            </div>
        </div>
        

    </div>

    <script>
        // ä½¿ç”¨ JSONBin.io ä½œä¸ºäº‘ç«¯å­˜å‚¨ï¼ˆå…è´¹ä¸”å¯é ï¼‰
        const API_BASE = 'https://api.jsonbin.io/v3/b';
        const BIN_ID = '675a2f4bad19ca34f8c9a1b2'; // å…¬å…±å­˜å‚¨ç®±
        const API_KEY = '$2a$10$8vJ9FqiTtGgHhYvN2QmJ4eF6RzP3WxY7KsL9MnB5CdE8FgH2IjK6L'; // å…¬å…±å¯†é’¥
        
        // åŒæ­¥é…ç½®
        let isCloudReady = true;
        let syncInProgress = false;
        const SYNC_INTERVAL = 15000; // 15ç§’æ£€æŸ¥ä¸€æ¬¡
        let lastSyncTime = 0;
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        let scheduleData = {
            responses: [],
            fixedEvents: [
                { date: '2024-12-19', title: 'å‘¨å¹´ç¥­é…ä¿¡ãƒ»æ ªä¸»ç·ä¼š' },
                { date: '2025-01-01', title: 'ã€Œé¯¨ã€éŒ²éŸ³å®Œäº†' },
                { date: '2025-01-11', title: 'ä¸‹åŒ—æ²¢threeå¯¾ãƒãƒ³ãƒ©ã‚¤ãƒ–' },
                { date: '2025-01-19', title: 'ãƒŸãƒƒã‚¯ã‚¹å®Œäº†ãƒ»é¯¨MVé…ä¿¡' }
            ],
            period: {
                start: '2024-12-14',
                end: '2025-01-31'
            }
        };
        
        // äº‘ç«¯åŒæ­¥çŠ¶æ€
        let isOnline = false;
        let syncIndicator = null;
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ« + è‡ªå‹•ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼‰
        function saveData() {
            // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
            localStorage.setItem('bandCalendarData', JSON.stringify(scheduleData));
            
            // è‡ªåŠ¨äº‘ç«¯åŒæ­¥
            autoSync();
        }
        
        // äº‘ç«¯åŒæ­¥åŠŸèƒ½
        async function syncToCloud() {
            if (!isCloudReady || syncInProgress) return;
            
            syncInProgress = true;
            showSyncIndicator('uploading');
            updateSyncStatus('syncing');
            
            try {
                const dataToSync = {
                    ...scheduleData,
                    lastModified: Date.now(),
                    version: Date.now()
                };
                
                const response = await fetch(`${API_BASE}/${BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(dataToSync)
                });
                
                if (response.ok) {
                    lastSyncTime = Date.now();
                    showSyncIndicator('success');
                    updateSyncStatus('online');
                    console.log('âœ… ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒ©ã‚¦ãƒ‰ã«åŒæœŸã•ã‚Œã¾ã—ãŸ');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error');
                updateSyncStatus('error');
            } finally {
                syncInProgress = false;
            }
        }
        
        async function loadFromCloud() {
            if (!isCloudReady || syncInProgress) return;
            
            syncInProgress = true;
            showSyncIndicator('downloading');
            updateSyncStatus('syncing');
            
            try {
                const response = await fetch(`${API_BASE}/${BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': API_KEY
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const cloudData = result.record;
                    
                    if (cloudData && cloudData.responses) {
                        // æ•°æ®åˆå¹¶é€»è¾‘
                        mergeCloudData(cloudData);
                        lastSyncTime = Date.now();
                        showSyncIndicator('success');
                        updateSyncStatus('online');
                        console.log('âœ… ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                        
                        // æ›´æ–°ç•Œé¢
                        refreshCurrentView();
                    } else {
                        // äº‘ç«¯æ²¡æœ‰æ•°æ®ï¼Œä¸Šä¼ æœ¬åœ°æ•°æ®
                        await syncToCloud();
                    }
                } else if (response.status === 404) {
                    // æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
                    await syncToCloud();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('âŒ è¯»å–ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error');
                updateSyncStatus('error');
                
                // ä½¿ç”¨æœ¬åœ°æ•°æ®
                const localData = localStorage.getItem('bandCalendarData');
                if (localData) {
                    scheduleData = JSON.parse(localData);
                }
            } finally {
                syncInProgress = false;
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸
        function mergeData(cloudData) {
            // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒãƒ¼ã‚¸ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ–°ã—ã„æ–¹ã‚’å„ªå…ˆï¼‰
            const mergedResponses = [...scheduleData.responses];
            
            cloudData.responses.forEach(cloudResponse => {
                const existingIndex = mergedResponses.findIndex(r => r.name === cloudResponse.name);
                if (existingIndex >= 0) {
                    // æ—¢å­˜ã®å›ç­”ãŒã‚ã‚‹å ´åˆã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ¯”è¼ƒ
                    if (new Date(cloudResponse.timestamp) > new Date(mergedResponses[existingIndex].timestamp)) {
                        mergedResponses[existingIndex] = cloudResponse;
                    }
                } else {
                    // æ–°ã—ã„å›ç­”ã‚’è¿½åŠ 
                    mergedResponses.push(cloudResponse);
                }
            });
            
            // å›ºå®šã‚¤ãƒ™ãƒ³ãƒˆã‚‚ãƒãƒ¼ã‚¸
            const mergedEvents = [...scheduleData.fixedEvents];
            cloudData.fixedEvents.forEach(cloudEvent => {
                if (!mergedEvents.some(e => e.date === cloudEvent.date)) {
                    mergedEvents.push(cloudEvent);
                }
            });
            
            // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
            scheduleData.responses = mergedResponses;
            scheduleData.fixedEvents = mergedEvents;
            scheduleData.period = cloudData.period || scheduleData.period;
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
            localStorage.setItem('bandCalendarData', JSON.stringify(scheduleData));
        }
        
        // åŒæœŸã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
        function showSyncIndicator(status) {
            if (!syncIndicator) {
                syncIndicator = document.createElement('div');
                syncIndicator.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 10px 15px;
                    border-radius: 5px;
                    color: white;
                    font-weight: bold;
                    z-index: 1000;
                    transition: all 0.3s;
                `;
                document.body.appendChild(syncIndicator);
            }
            
            switch(status) {
                case 'uploading':
                    syncIndicator.style.background = '#ff8c00';
                    syncIndicator.textContent = 'ğŸ“¤ åŒæœŸä¸­...';
                    break;
                case 'downloading':
                    syncIndicator.style.background = '#17a2b8';
                    syncIndicator.textContent = 'ğŸ“¥ èª­ã¿è¾¼ã¿ä¸­...';
                    break;
                case 'success':
                    syncIndicator.style.background = '#28a745';
                    syncIndicator.textContent = 'âœ… åŒæœŸå®Œäº†';
                    setTimeout(() => {
                        if (syncIndicator) {
                            syncIndicator.style.opacity = '0';
                            setTimeout(() => {
                                if (syncIndicator && syncIndicator.parentNode) {
                                    syncIndicator.parentNode.removeChild(syncIndicator);
                                    syncIndicator = null;
                                }
                            }, 300);
                        }
                    }, 2000);
                    break;
                case 'error':
                    syncIndicator.style.background = '#dc3545';
                    syncIndicator.textContent = 'âŒ åŒæœŸã‚¨ãƒ©ãƒ¼';
                    setTimeout(() => {
                        if (syncIndicator) {
                            syncIndicator.style.opacity = '0';
                            setTimeout(() => {
                                if (syncIndicator && syncIndicator.parentNode) {
                                    syncIndicator.parentNode.removeChild(syncIndicator);
                                    syncIndicator = null;
                                }
                            }, 300);
                        }
                    }, 3000);
                    break;
            }
            
            syncIndicator.style.opacity = '1';
        }
        
        // æ™ºèƒ½æ•°æ®åˆå¹¶
        function mergeCloudData(cloudData) {
            // åˆå¹¶å›ç­”æ•°æ®ï¼ˆä¿ç•™æœ€æ–°çš„ï¼‰
            const mergedResponses = [...scheduleData.responses];
            
            if (cloudData.responses) {
                cloudData.responses.forEach(cloudResponse => {
                    const existingIndex = mergedResponses.findIndex(r => r.name === cloudResponse.name);
                    if (existingIndex >= 0) {
                        // æ¯”è¾ƒæ—¶é—´æˆ³ï¼Œä¿ç•™æœ€æ–°çš„
                        const existingTime = new Date(mergedResponses[existingIndex].timestamp).getTime();
                        const cloudTime = new Date(cloudResponse.timestamp).getTime();
                        
                        if (cloudTime > existingTime) {
                            mergedResponses[existingIndex] = cloudResponse;
                        }
                    } else {
                        mergedResponses.push(cloudResponse);
                    }
                });
            }
            
            // åˆå¹¶å›ºå®šäº‹ä»¶
            const mergedEvents = [...scheduleData.fixedEvents];
            if (cloudData.fixedEvents) {
                cloudData.fixedEvents.forEach(cloudEvent => {
                    if (!mergedEvents.some(e => e.date === cloudEvent.date)) {
                        mergedEvents.push(cloudEvent);
                    }
                });
            }
            
            // æ›´æ–°æ•°æ®
            scheduleData.responses = mergedResponses;
            scheduleData.fixedEvents = mergedEvents;
            if (cloudData.period) {
                scheduleData.period = cloudData.period;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°
            localStorage.setItem('bandCalendarData', JSON.stringify(scheduleData));
        }
        
        // åˆ·æ–°å½“å‰è§†å›¾
        function refreshCurrentView() {
            const activeTab = document.querySelector('.nav-tab.active');
            if (activeTab) {
                const tabText = activeTab.textContent;
                if (tabText.includes('çµæœ')) {
                    generateResultsPanel();
                } else if (tabText.includes('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼')) {
                    generateCalendar();
                    updateProgress();
                } else if (tabText.includes('ç®¡ç†')) {
                    generateAdminPanel();
                }
            }
        }
        
        // å®šæœŸåŒæ­¥
        function setupPeriodicSync() {
            setInterval(async () => {
                if (isCloudReady && !syncInProgress && Date.now() - lastSyncTime > SYNC_INTERVAL) {
                    await loadFromCloud();
                }
            }, SYNC_INTERVAL);
        }
        
        // è‡ªåŠ¨åŒæ­¥ï¼ˆæ•°æ®å˜æ›´æ—¶ï¼‰
        function autoSync() {
            if (isCloudReady && !syncInProgress) {
                // å»¶è¿ŸåŒæ­¥ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                clearTimeout(window.autoSyncTimeout);
                window.autoSyncTimeout = setTimeout(async () => {
                    await syncToCloud();
                }, 3000);
            }
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'calendar') {
                generateCalendar();
            } else if (tabName === 'admin') {
                generateAdminPanel();
            } else if (tabName === 'results') {
                generateResultsPanel();
            }
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateCalendar() {
            const container = document.getElementById('calendarContainer');
            const startDate = new Date(scheduleData.period.start);
            const endDate = new Date(scheduleData.period.end);
            
            let html = '';
            let currentDate = new Date(startDate);
            
            // æœˆã”ã¨ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
            while (currentDate <= endDate) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                html += generateMonthCalendar(year, month);
                
                // æ¬¡ã®æœˆã¸
                currentDate.setMonth(month + 1);
                currentDate.setDate(1);
            }
            
            container.innerHTML = html;
        }
        
        // æœˆåˆ¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateMonthCalendar(year, month) {
            // æœˆã®æœ€åˆã®æ—¥
            const firstDay = new Date(year, month, 1);
            // æœˆã®æœ€å¾Œã®æ—¥
            const lastDay = new Date(year, month + 1, 0);
            
            // æœ€åˆã®æ—¥ãŒä½•æ›œæ—¥ã‹ã‚’å–å¾— (0=æ—¥æ›œæ—¥, 1=æœˆæ›œæ—¥, ...)
            const firstDayOfWeek = firstDay.getDay();
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥ã‚’æ­£ç¢ºã«è¨ˆç®—
            // 12æœˆ1æ—¥ãŒæœˆæ›œæ—¥ãªã‚‰ã€æ—¥æ›œæ—¥ã‹ã‚‰é–‹å§‹ã—ã¦30,1,2,3...ã®é †ç•ªã«ã™ã‚‹
            const startDate = new Date(year, month - 1, 30); // å‰æœˆã®30æ—¥ã‹ã‚‰é–‹å§‹
            
            let html = `
                <div class="calendar-section">
                    <div class="month-title">ğŸ“… ${year}å¹´${month + 1}æœˆ</div>
                    <div class="calendar">
                        <div class="calendar-header">æ—¥</div>
                        <div class="calendar-header">æœˆ</div>
                        <div class="calendar-header">ç«</div>
                        <div class="calendar-header">æ°´</div>
                        <div class="calendar-header">æœ¨</div>
                        <div class="calendar-header">é‡‘</div>
                        <div class="calendar-header">åœŸ</div>
            `;
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
            let currentDate = new Date(startDate);
            
            // 6é€±é–“åˆ†ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    // æ—¥ä»˜æ–‡å­—åˆ—ã‚’ç”Ÿæˆ
                    const dateYear = currentDate.getFullYear();
                    const dateMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const dateDay = String(currentDate.getDate()).padStart(2, '0');
                    const dateStr = `${dateYear}-${dateMonth}-${dateDay}`;
                    
                    // ç¾åœ¨ã®æœˆã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isSelectable = isCurrentMonth && isDateSelectable(dateStr);
                    const fixedEvent = scheduleData.fixedEvents.find(e => e.date === dateStr);
                    
                    // CSSã‚¯ãƒ©ã‚¹ã‚’è¨­å®š
                    let dayClass = 'calendar-day';
                    if (!isCurrentMonth) dayClass += ' other-month';
                    if (isSelectable) dayClass += ' selectable';
                    if (fixedEvent) dayClass += ' fixed-event';
                    
                    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const today = new Date();
                    const isToday = currentDate.getFullYear() === today.getFullYear() &&
                                   currentDate.getMonth() === today.getMonth() &&
                                   currentDate.getDate() === today.getDate();
                    if (isToday) dayClass += ' today';
                    
                    html += `<div class="${dayClass}" onclick="toggleDateStatus('${dateStr}')">`;
                    html += `<div class="date-number">${currentDate.getDate()}</div>`;
                    
                    if (fixedEvent) {
                        html += `<div class="event-label fixed">${fixedEvent.title}</div>`;
                    } else if (isSelectable) {
                        html += `<div class="event-label">ç·´ç¿’å€™è£œ</div>`;
                        html += `<div class="status-marker" data-date="${dateStr}"></div>`;
                    }
                    
                    html += '</div>';
                    
                    // æ¬¡ã®æ—¥ã«é€²ã‚€
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                // æ¬¡ã®æœˆã«å…¥ã£ãŸã‚‰çµ‚äº†ï¼ˆæœ€ä½4é€±ã¯è¡¨ç¤ºï¼‰
                if (currentDate.getMonth() !== month && week >= 3) break;
            }
            
            html += '</div></div>';
            return html;
        }
        
        // æ—¥ä»˜ãŒé¸æŠå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
        function isDateSelectable(dateStr) {
            // æ™‚åŒºå•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚ã€æ­£åˆã®æ™‚é–“ã§æ¯”è¼ƒ
            const date = new Date(dateStr + 'T12:00:00');
            const start = new Date(scheduleData.period.start + 'T12:00:00');
            const end = new Date(scheduleData.period.end + 'T12:00:00');
            
            return date >= start && date <= end && 
                   !scheduleData.fixedEvents.some(e => e.date === dateStr);
        }
        
        // æ—¥ä»˜ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆ
        function toggleDateStatus(dateStr) {
            if (!isDateSelectable(dateStr)) return;
            
            const marker = document.querySelector(`[data-date="${dateStr}"]`);
            if (!marker) return;
            
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—
            let currentStatus = '';
            if (marker.classList.contains('selected-good')) currentStatus = 'good';
            else if (marker.classList.contains('selected-ok')) currentStatus = 'ok';
            else if (marker.classList.contains('selected-bad')) currentStatus = 'bad';
            
            // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆ
            const statuses = ['', 'good', 'ok', 'bad'];
            const symbols = ['', 'â—‹', 'â–³', 'âœ•'];
            const currentIndex = statuses.indexOf(currentStatus);
            const nextIndex = (currentIndex + 1) % statuses.length;
            
            // ã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
            marker.classList.remove('selected-good', 'selected-ok', 'selected-bad');
            marker.textContent = '';
            
            // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
            if (statuses[nextIndex]) {
                marker.classList.add(`selected-${statuses[nextIndex]}`);
                marker.textContent = symbols[nextIndex];
            }
        }
        
        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é€ä¿¡
        function submitSchedule() {
            const name = document.getElementById('userName').value.trim();
            if (!name) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // é¸æŠã•ã‚ŒãŸæ—¥ç¨‹ã‚’åé›†
            const selections = {};
            document.querySelectorAll('.status-marker.selected-good, .status-marker.selected-ok, .status-marker.selected-bad').forEach(marker => {
                const date = marker.dataset.date;
                let status = '';
                if (marker.classList.contains('selected-good')) status = 'good';
                else if (marker.classList.contains('selected-ok')) status = 'ok';
                else if (marker.classList.contains('selected-bad')) status = 'bad';
                
                if (status) selections[date] = status;
            });
            
            if (Object.keys(selections).length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®æ—¥ç¨‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            const existingIndex = scheduleData.responses.findIndex(r => r.name === name);
            const response = {
                name: name,
                selections: selections,
                timestamp: new Date().toISOString()
            };
            
            if (existingIndex >= 0) {
                if (confirm('æ—¢å­˜ã®å›ç­”ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ')) {
                    scheduleData.responses[existingIndex] = response;
                } else {
                    return;
                }
            } else {
                scheduleData.responses.push(response);
            }
            
            saveData();
            alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('userName').value = '';
            document.querySelectorAll('.status-marker').forEach(marker => {
                marker.classList.remove('selected-good', 'selected-ok', 'selected-bad');
                marker.textContent = '';
            });
        }
        
        // ç®¡ç†ç”»é¢ç”Ÿæˆ
        function generateAdminPanel() {
            const eventsList = document.getElementById('eventsList');
            eventsList.innerHTML = scheduleData.fixedEvents.map((event, index) => `
                <div class="form-row">
                    <input type="date" value="${event.date}" class="form-input" readonly>
                    <input type="text" value="${event.title}" class="form-input" readonly>
                    <button class="btn btn-danger" onclick="removeEvent(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
            
            document.getElementById('startDate').value = scheduleData.period.start;
            document.getElementById('endDate').value = scheduleData.period.end;
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
        function addEvent() {
            const date = document.getElementById('newEventDate').value;
            const title = document.getElementById('newEventTitle').value.trim();
            
            if (!date || !title) {
                alert('æ—¥ä»˜ã¨ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            scheduleData.fixedEvents.push({ date, title });
            scheduleData.fixedEvents.sort((a, b) => a.date.localeCompare(b.date));
            saveData();
            generateAdminPanel();
            
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventTitle').value = '';
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤
        function removeEvent(index) {
            if (confirm('ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                scheduleData.fixedEvents.splice(index, 1);
                saveData();
                generateAdminPanel();
            }
        }
        
        // æœŸé–“æ›´æ–°
        function updatePeriod() {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            
            if (!start || !end) {
                alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (start >= end) {
                alert('çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„');
                return;
            }
            
            scheduleData.period = { start, end };
            saveData();
            alert('æœŸé–“ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
        }
        
        // é¸æŠãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹
        let selectMode = false;
        let selectedResponses = new Set();
        
        // çµæœç”»é¢ç”Ÿæˆ
        function generateResultsPanel() {
            const resultsList = document.getElementById('resultsList');
            
            if (scheduleData.responses.length === 0) {
                resultsList.innerHTML = '<p style="text-align: center; color: #cccccc; padding: 40px;">ã¾ã å›ç­”ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            resultsList.innerHTML = scheduleData.responses.map((response, index) => `
                <div class="result-item" data-index="${index}">
                    ${selectMode ? `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="checkbox-${index}" onchange="updateSelection(${index})" 
                                   style="margin-right: 10px; transform: scale(1.2);">
                            <label for="checkbox-${index}" style="color: #ff4444; font-weight: bold; font-size: 1.1em; cursor: pointer;">${response.name}</label>
                        </div>
                    ` : `
                        <div class="result-name">${response.name}</div>
                    `}
                    <div class="result-summary">
                        ${Object.entries(response.selections).map(([date, status]) => `
                            <div class="result-date result-${status}">
                                ${formatDateShort(date)}: ${getStatusText(status)}
                            </div>
                        `).join('')}
                    </div>
                    <div style="font-size: 12px; color: #cccccc; margin-top: 10px;">
                        é€ä¿¡: ${new Date(response.timestamp).toLocaleString('ja-JP')}
                    </div>
                </div>
            `).join('');
        }
        
        // ã‚µãƒãƒªãƒ¼è¡¨ç¤º
        function showSummary() {
            const summarySection = document.getElementById('summarySection');
            const summaryContent = document.getElementById('summaryContent');
            
            // æ—¥ä»˜åˆ¥é›†è¨ˆ
            const dateSummary = {};
            scheduleData.responses.forEach(response => {
                Object.entries(response.selections).forEach(([date, status]) => {
                    if (!dateSummary[date]) {
                        dateSummary[date] = { good: 0, ok: 0, bad: 0 };
                    }
                    dateSummary[date][status]++;
                });
            });
            
            const sortedDates = Object.keys(dateSummary).sort();
            
            summaryContent.innerHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 15px; background: #2d2d2d; border: 1px solid #ff4444;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);">
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">æ—¥ä»˜</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">å¸Œæœ›</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">å¯èƒ½</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">ä¸å¯</th>
                                <th style="border: 1px solid #ff4444; padding: 10px; color: #ffffff;">åˆè¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedDates.map(date => {
                                const summary = dateSummary[date];
                                const total = summary.good + summary.ok + summary.bad;
                                return `
                                    <tr>
                                        <td style="border: 1px solid #ff4444; padding: 10px; font-weight: bold; color: #ffffff;">${formatDateWithDay(date)}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); color: #000000;">${summary.good}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #666666 0%, #888888 100%); color: #ffffff;">${summary.ok}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%); color: #ffffff;">${summary.bad}</td>
                                        <td style="border: 1px solid #ff4444; padding: 10px; text-align: center; font-weight: bold; color: #ffffff;">${total}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            summarySection.style.display = 'block';
        }
        
        // çµæœæ›´æ–°
        function refreshResults() {
            generateResultsPanel();
            document.getElementById('summarySection').style.display = 'none';
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportResults() {
            const data = {
                exportDate: new Date().toISOString(),
                period: scheduleData.period,
                fixedEvents: scheduleData.fixedEvents,
                responses: scheduleData.responses
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `band-calendar-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleSelectMode() {
            selectMode = !selectMode;
            selectedResponses.clear();
            
            if (selectMode) {
                document.getElementById('selectModeBtn').style.display = 'none';
                document.getElementById('selectAllBtn').style.display = 'inline-block';
                document.getElementById('selectNoneBtn').style.display = 'inline-block';
                document.getElementById('deleteSelectedBtn').style.display = 'inline-block';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                document.getElementById('selectedCount').style.display = 'inline-block';
            } else {
                document.getElementById('selectModeBtn').style.display = 'inline-block';
                document.getElementById('selectAllBtn').style.display = 'none';
                document.getElementById('selectNoneBtn').style.display = 'none';
                document.getElementById('deleteSelectedBtn').style.display = 'none';
                document.getElementById('cancelBtn').style.display = 'none';
                document.getElementById('selectedCount').style.display = 'none';
            }
            
            generateResultsPanel();
            updateSelectedCount();
        }
        
        // é¸æŠãƒ¢ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        function cancelSelectMode() {
            selectMode = false;
            selectedResponses.clear();
            toggleSelectMode();
        }
        
        // é¸æŠçŠ¶æ…‹æ›´æ–°
        function updateSelection(index) {
            const checkbox = document.getElementById(`checkbox-${index}`);
            if (checkbox.checked) {
                selectedResponses.add(index);
            } else {
                selectedResponses.delete(index);
            }
            updateSelectedCount();
        }
        
        // é¸æŠæ•°è¡¨ç¤ºæ›´æ–°
        function updateSelectedCount() {
            const count = selectedResponses.size;
            document.getElementById('selectedCount').textContent = `é¸æŠ: ${count}ä»¶`;
            
            // å‰Šé™¤ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            deleteBtn.disabled = count === 0;
            deleteBtn.style.opacity = count === 0 ? '0.5' : '1';
        }
        
        // å…¨é¸æŠ
        function selectAll() {
            selectedResponses.clear();
            for (let i = 0; i < scheduleData.responses.length; i++) {
                selectedResponses.add(i);
                const checkbox = document.getElementById(`checkbox-${i}`);
                if (checkbox) checkbox.checked = true;
            }
            updateSelectedCount();
        }
        
        // é¸æŠè§£é™¤
        function selectNone() {
            selectedResponses.clear();
            for (let i = 0; i < scheduleData.responses.length; i++) {
                const checkbox = document.getElementById(`checkbox-${i}`);
                if (checkbox) checkbox.checked = false;
            }
            updateSelectedCount();
        }
        
        // é¸æŠé …ç›®å‰Šé™¤
        function deleteSelected() {
            if (selectedResponses.size === 0) {
                alert('å‰Šé™¤ã™ã‚‹é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const count = selectedResponses.size;
            const names = Array.from(selectedResponses).map(index => scheduleData.responses[index].name).join('ã€');
            
            if (confirm(`ä»¥ä¸‹ã®${count}ä»¶ã®å›ç­”ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\n${names}\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é™é †ã§ã‚½ãƒ¼ãƒˆã—ã¦å‰Šé™¤ï¼ˆé…åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒãšã‚Œãªã„ã‚ˆã†ã«ï¼‰
                const sortedIndices = Array.from(selectedResponses).sort((a, b) => b - a);
                
                sortedIndices.forEach(index => {
                    scheduleData.responses.splice(index, 1);
                });
                
                saveData();
                selectedResponses.clear();
                generateResultsPanel();
                updateSelectedCount();
                
                alert(`${count}ä»¶ã®å›ç­”ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ`);
                
                // å‰Šé™¤å¾Œã«é¸æŠãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†
                if (scheduleData.responses.length === 0) {
                    cancelSelectMode();
                }
            }
        }
        
        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
        function showImportSection() {
            document.getElementById('importSection').style.display = 'block';
        }
        
        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º
        function hideImportSection() {
            document.getElementById('importSection').style.display = 'none';
            document.getElementById('importFile').value = '';
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ¤œè¨¼
                    if (!importedData.responses || !Array.isArray(importedData.responses)) {
                        alert('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');
                        return;
                    }
                    
                    const responseCount = importedData.responses.length;
                    
                    if (confirm(`${responseCount}ä»¶ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¨çµ±åˆã—ã¾ã™ã‹ï¼Ÿ\n\næ³¨æ„ï¼šåŒã˜åå‰ã®å›ç­”ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚`)) {
                        // æ—¢å­˜ã®å›ç­”ã¨çµ±åˆï¼ˆåŒã˜åå‰ã¯ä¸Šæ›¸ãï¼‰
                        const existingNames = scheduleData.responses.map(r => r.name);
                        const newResponses = importedData.responses.filter(r => !existingNames.includes(r.name));
                        const updatedResponses = importedData.responses.filter(r => existingNames.includes(r.name));
                        
                        // æ–°ã—ã„å›ç­”ã‚’è¿½åŠ 
                        scheduleData.responses = [...scheduleData.responses, ...newResponses];
                        
                        // æ—¢å­˜ã®å›ç­”ã‚’æ›´æ–°
                        updatedResponses.forEach(updatedResponse => {
                            const index = scheduleData.responses.findIndex(r => r.name === updatedResponse.name);
                            if (index >= 0) {
                                scheduleData.responses[index] = updatedResponse;
                            }
                        });
                        
                        // å›ºå®šã‚¤ãƒ™ãƒ³ãƒˆã‚‚çµ±åˆ
                        if (importedData.fixedEvents) {
                            const existingEvents = scheduleData.fixedEvents.map(e => e.date);
                            const newEvents = importedData.fixedEvents.filter(e => !existingEvents.includes(e.date));
                            scheduleData.fixedEvents = [...scheduleData.fixedEvents, ...newEvents];
                        }
                        
                        saveData();
                        generateResultsPanel();
                        hideImportSection();
                        
                        alert(`ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\næ–°è¦: ${newResponses.length}ä»¶\næ›´æ–°: ${updatedResponses.length}ä»¶`);
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    console.error('Import error:', error);
                }
            };
            
            reader.readAsText(file);
        }
        
        // åŒæœŸçŠ¶æ…‹æ›´æ–°
        function updateSyncStatus(status) {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            switch(status) {
                case 'online':
                    syncIcon.textContent = 'â˜ï¸';
                    syncText.textContent = 'ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸæœ‰åŠ¹ - è‡ªå‹•åŒæœŸä¸­';
                    syncText.style.color = '#28a745';
                    break;
                case 'offline':
                    syncIcon.textContent = 'ğŸ“±';
                    syncText.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰';
                    syncText.style.color = '#ffc107';
                    break;
                case 'syncing':
                    syncIcon.textContent = 'ğŸ”„';
                    syncText.textContent = 'åŒæœŸä¸­...';
                    syncText.style.color = '#17a2b8';
                    break;
                case 'error':
                    syncIcon.textContent = 'âš ï¸';
                    syncText.textContent = 'åŒæœŸã‚¨ãƒ©ãƒ¼ - ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ç¶™ç¶š';
                    syncText.style.color = '#dc3545';
                    break;
                case 'ready':
                    syncIcon.textContent = 'ğŸŒ';
                    syncText.textContent = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŒæœŸæº–å‚™å®Œäº†';
                    syncText.style.color = '#17a2b8';
                    break;
            }
        }
        
        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearAllData() {
            if (confirm('å…¨ã¦ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                scheduleData.responses = [];
                saveData();
                alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
                generateResultsPanel();
            }
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatDateShort(dateStr) {
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }
        
        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr);
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆ${days[date.getDay()]}ï¼‰`;
        }
        
        function getStatusText(status) {
            const texts = { good: 'å¸Œæœ›', ok: 'å¯èƒ½', bad: 'ä¸å¯' };
            return texts[status] || status;
        }
        
        // ä¾¿åˆ©æ©Ÿèƒ½ï¼šå…¨ã¦ã®æ—¥ç¨‹ã«åŒã˜ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
        function setAllStatus(status) {
            const markers = document.querySelectorAll('.status-marker');
            const symbols = { good: 'â—‹', ok: 'â–³', bad: 'âœ•' };
            
            markers.forEach(marker => {
                // æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
                marker.classList.remove('selected-good', 'selected-ok', 'selected-bad');
                marker.textContent = '';
                
                // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
                if (status) {
                    marker.classList.add(`selected-${status}`);
                    marker.textContent = symbols[status];
                }
            });
            
            // é€²æ—æ›´æ–°ã¨è‡ªå‹•ä¿å­˜
            updateProgress();
            autoSave();
        }
        
        // ä¾¿åˆ©æ©Ÿèƒ½ï¼šå…¨ã¦ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
        function clearAllStatus() {
            setAllStatus('');
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        setAllStatus('good');
                        break;
                    case '2':
                        e.preventDefault();
                        setAllStatus('ok');
                        break;
                    case '3':
                        e.preventDefault();
                        setAllStatus('bad');
                        break;
                    case '0':
                        e.preventDefault();
                        clearAllStatus();
                        break;
                }
            }
        });
        
        // é€²æ—æ›´æ–°
        function updateProgress() {
            const totalMarkers = document.querySelectorAll('.status-marker').length;
            const selectedMarkers = document.querySelectorAll('.status-marker.selected-good, .status-marker.selected-ok, .status-marker.selected-bad').length;
            
            document.getElementById('selectedCount').textContent = selectedMarkers;
            document.getElementById('totalCount').textContent = totalMarkers;
            
            const percentage = totalMarkers > 0 ? (selectedMarkers / totalMarkers) * 100 : 0;
            document.getElementById('progressFill').style.width = percentage + '%';
            
            // é€ä¿¡ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            const submitBtn = document.getElementById('submitBtn');
            const name = document.getElementById('userName').value.trim();
            
            if (name && selectedMarkers > 0) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é€ä¿¡';
            } else {
                submitBtn.disabled = true;
                if (!name) {
                    submitBtn.textContent = 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                } else {
                    submitBtn.textContent = 'æ—¥ç¨‹ã‚’é¸æŠã—ã¦ãã ã•ã„';
                }
            }
        }
        
        // è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
        function autoSave() {
            const name = document.getElementById('userName').value.trim();
            if (!name) return;
            
            const selections = {};
            document.querySelectorAll('.status-marker.selected-good, .status-marker.selected-ok, .status-marker.selected-bad').forEach(marker => {
                const date = marker.dataset.date;
                let status = '';
                if (marker.classList.contains('selected-good')) status = 'good';
                else if (marker.classList.contains('selected-ok')) status = 'ok';
                else if (marker.classList.contains('selected-bad')) status = 'bad';
                
                if (status) selections[date] = status;
            });
            
            // ä¸€æ™‚ä¿å­˜
            localStorage.setItem('tempCalendarData', JSON.stringify({
                name: name,
                selections: selections,
                timestamp: new Date().toISOString()
            }));
            
            // é€²æ—æ›´æ–°
            updateProgress();
        }
        
        // ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ
        function restoreTempData() {
            const tempData = localStorage.getItem('tempCalendarData');
            if (!tempData) return;
            
            try {
                const data = JSON.parse(tempData);
                document.getElementById('userName').value = data.name;
                
                // é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
                Object.entries(data.selections).forEach(([date, status]) => {
                    const marker = document.querySelector(`[data-date="${date}"]`);
                    if (marker) {
                        const symbols = { good: 'â—‹', ok: 'â–³', bad: 'âœ•' };
                        marker.classList.add(`selected-${status}`);
                        marker.textContent = symbols[status];
                    }
                });
            } catch (e) {
                console.log('ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ
        function generateShareLink() {
            const data = btoa(JSON.stringify(scheduleData));
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?data=${encodeURIComponent(data)}`;
            
            document.getElementById('shareLink').value = shareUrl;
            document.getElementById('shareSection').style.display = 'block';
            
            // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            generateQRCode(shareUrl);
        }
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function generateQRCode(url) {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            // Google Charts QR Code API ã‚’ä½¿ç”¨
            const qrUrl = `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${encodeURIComponent(url)}`;
            const img = document.createElement('img');
            img.src = qrUrl;
            img.style.width = '200px';
            img.style.height = '200px';
            img.alt = 'QR Code';
            
            qrContainer.appendChild(img);
        }
        
        // å…±æœ‰ãƒªãƒ³ã‚¯ã‚³ãƒ”ãƒ¼
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                alert('ãƒªãƒ³ã‚¯ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã“ã®ãƒªãƒ³ã‚¯ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚');
            } catch (err) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        // URL ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadDataFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const decodedData = JSON.parse(atob(decodeURIComponent(dataParam)));
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç½®ãæ›ãˆã‚‹ï¼ˆã‚ˆã‚Šç¢ºå®ŸãªåŒæœŸï¼‰
                    if (confirm('å…±æœ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã§ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ\n\næ³¨æ„ï¼šç¾åœ¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚')) {
                        scheduleData = decodedData;
                        saveData();
                        alert('ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«åŒæœŸã•ã‚Œã¾ã—ãŸï¼');
                        
                        // URLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                        window.history.replaceState({}, document.title, window.location.pathname);
                        
                        // ç”»é¢ã‚’æ›´æ–°
                        if (document.querySelector('.nav-tab.active').textContent.includes('çµæœ')) {
                            generateResultsPanel();
                        }
                    }
                } catch (e) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒªãƒ³ã‚¯ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            isOnline = navigator.onLine;
            
            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ ã‚¤ãƒ™ãƒ³ãƒˆ
            window.addEventListener('online', async () => {
                isOnline = true;
                if (isCloudReady) {
                    updateSyncStatus('ready');
                    await loadFromCloud();
                    setupPeriodicSync();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateSyncStatus('offline');
            });
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆã«èª­ã¿è¾¼ã¿
            const localData = localStorage.getItem('bandCalendarData');
            if (localData) {
                scheduleData = JSON.parse(localData);
            }
            
            // URLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadDataFromUrl();
            
            // ç½‘ç»œçŠ¶æ€æ£€æŸ¥å’Œäº‘ç«¯åŒæ­¥åˆå§‹åŒ–
            if (navigator.onLine && isCloudReady) {
                updateSyncStatus('ready');
                // å¯åŠ¨æ—¶å…ˆåŠ è½½äº‘ç«¯æ•°æ®
                setTimeout(async () => {
                    await loadFromCloud();
                    // ç„¶åå¼€å§‹å®šæœŸåŒæ­¥
                    setupPeriodicSync();
                }, 1000);
            } else {
                updateSyncStatus('offline');
            }
            
            generateCalendar();
            restoreTempData();
            
            // è‡ªå‹•ä¿å­˜ã®è¨­å®š
            document.getElementById('userName').addEventListener('input', function() {
                updateProgress();
                autoSave();
            });
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('status-marker')) {
                    setTimeout(function() {
                        updateProgress();
                        autoSave();
                    }, 100);
                }
            });
            
            // åˆæœŸé€²æ—æ›´æ–°
            updateProgress();
        });
    </script>
</body>
</html>